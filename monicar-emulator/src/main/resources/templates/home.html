<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <link rel="stylesheet" href="../style/home.css">
</head>
<body>
<h1 id="title"> í˜„ì¬ ì°¨ëŸ‰ ìƒíƒœ : ì •ì§€ ğŸš˜ </h1>
<h2 id="gps-info"> Gps ì „ì†¡ ëŒ€ê¸°ì¤‘. . . </h2>
<h3 id="gps-status"></h3>
<div class="vehicle-event-button-container">
    <h4>ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘</h4>
    <button id="vehicle-on" class="vehicle-event-button">ON</button>
</div>

<div class="vehicle-event-button-container">
    <h4>ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ</h4>
    <button id="vehicle-off" class="vehicle-event-button">OFF</button>
</div>

<script>
    /* ===================== 1) ê³µí†µ í•¨ìˆ˜ ì •ì˜ ===================== */
    /**
     * @param {string} elementId - ë³€ê²½í•  DOM ì—˜ë¦¬ë¨¼íŠ¸ì˜ ID
     * @param {string} temporaryText - ì ì‹œ í‘œì‹œí•  í…ìŠ¤íŠ¸(ì—ëŸ¬ ë©”ì„¸ì§€ ë“±)
     * @param {number} revertDelay - ì›ìƒ ë³µê·€ê¹Œì§€ ê¸°ë‹¤ë¦´ ì‹œê°„(ms)
     */
    function showTemporaryMessage(elementId, temporaryText, revertDelay = 3000) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const originalText = element.textContent;

        element.textContent = temporaryText;

        setTimeout(() => {
            element.textContent = originalText;
        }, revertDelay);
    }
</script>

<script>
    /* ===================== 2) SSE ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ===================== */
    const eventSource = new EventSource('/api/v1/emulator/sse/stream');

    eventSource.addEventListener("gpsData", function (event) {
        document.getElementById("gps-info").textContent = `ğŸ“ í˜„ì¬ ìœ„ì¹˜: ${event.data}`;
    });

    eventSource.addEventListener("gpsStatus", function (event) {
        document.getElementById("gps-status").textContent = `ğŸ“¡ ${event.data}`;

        setTimeout(() => {
            document.getElementById("gps-status").textContent = ""
        }, 3000)
    });

    eventSource.onerror = function (error) {
        console.error("ğŸš¨ SSE ì˜¤ë¥˜ ë°œìƒ:", error);
        showTemporaryMessage("gps-info", "âŒ GPS ë°ì´í„° ìˆ˜ì‹  ë¶ˆê°€", 3000);
        showTemporaryMessage("gps-status", "âŒ ìƒíƒœ ìŠ¤íŠ¸ë¦¼ ì˜¤ë¥˜", 3000);
    };
</script>

<script>
    /* ===================== 3) ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘/ì¢…ë£Œ fetch ë¡œì§ ===================== */
    document.getElementById("vehicle-on").addEventListener("click", function () {
        fetch('/api/v1/emulator/key-on', {
            method: 'POST',
            headers: {
                'Accept': 'application/json'
            }
        })
                .then(response => response.json())
                .then(data => {
                    console.log('ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘ ìš”ì²­ ê²°ê³¼:', data);
                    if (data.isSuccess) {
                        document.getElementById("title").textContent = "í˜„ì¬ ì°¨ëŸ‰ ìƒíƒœ : ìš´í–‰ì¤‘ ğŸš—ğŸ’¨";
                    } else {
                        showTemporaryMessage("title", "âŒ ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘ ë¶ˆê°€", 3000);
                    }
                })
                .catch(error => {
                    console.error('ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘ ì‹¤íŒ¨:', error);
                    showTemporaryMessage("title", "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ ë°œìƒ", 3000);
                });
    });

    document.getElementById("vehicle-off").addEventListener("click", function () {
        fetch('/api/v1/emulator/key-off', {
            method: 'POST',
            headers: {
                'Accept': 'application/json'
            }
        })
                .then(response => response.json())
                .then(data => {
                    console.log('ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ ìš”ì²­ ê²°ê³¼:', data);
                    if (data.isSuccess) {
                        document.getElementById("title").textContent = "í˜„ì¬ ì°¨ëŸ‰ ìƒíƒœ : ì •ì§€ ğŸš˜";
                    } else {
                        showTemporaryMessage("title", "âŒ ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ ë¶ˆê°€", 3000);
                    }
                })
                .catch(error => {
                    console.error('ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ ì‹¤íŒ¨:', error);
                    showTemporaryMessage("title", "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ ë°œìƒ", 3000);
                });
    });

</script>
</body>
</html>