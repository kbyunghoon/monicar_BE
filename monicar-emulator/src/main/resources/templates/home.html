<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <link rel="stylesheet" href="/style/home.css">
</head>
<body>
<h1 id="title"> í˜„ì¬ ì°¨ëŸ‰ ìƒíƒœ : ì •ì§€ ğŸš˜ </h1>
<h2 id="gps-info"> Gps ì „ì†¡ ëŒ€ê¸°ì¤‘. . . </h2>
<h3 id="gps-status"></h3>
<div class="vehicle-event-button-container">
    <h4>ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘</h4>
    <button id="vehicle-on" class="vehicle-event-button">ON</button>
</div>

<div class="vehicle-event-button-container">
    <h4>ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ</h4>
    <button id="vehicle-off" class="vehicle-event-button">OFF</button>
</div>

<script>
    const eventSource = new EventSource('/api/v1/emulator/sse/stream');

    eventSource.addEventListener("gpsData", function (event) {
        document.getElementById("gps-info").textContent = `ğŸ“ í˜„ì¬ ìœ„ì¹˜: ${event.data}`;
    });

    eventSource.addEventListener("gpsStatus", function (event) {
        document.getElementById("gps-status").textContent = `ğŸ“¡ ${event.data}`;

        setTimeout(() => {
            document.getElementById("gps-status").textContent = ""
        }, 3000)
    });

    eventSource.onerror = function (error) {
        console.error("ğŸš¨ SSE ì˜¤ë¥˜ ë°œìƒ:", error);
        document.getElementById("gps-info").textContent = "âŒ GPS ë°ì´í„° ìˆ˜ì‹  ë¶ˆê°€";
        document.getElementById("gps-status").textContent = "âŒ ìƒíƒœ ìŠ¤íŠ¸ë¦¼ ì˜¤ë¥˜";

        setTimeout(() => {
            document.getElementById("gps-info").textContent = "Gps ì „ì†¡ ëŒ€ê¸°ì¤‘. . .";
            document.getElementById("gps-status").textContent = "";
        }, 3000);
    };
</script>

<script>
    document.getElementById("vehicle-on").addEventListener("click", function () {
        fetch('/api/v1/emulator/key-on', {
            method: 'POST',
            headers: {
                'Accept': 'application/json'
            }
        })
                .then(response => response.json())
                .then(data => {
                    console.log('ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘ ìš”ì²­ ê²°ê³¼:', data);
                    if (data.isSuccess) {
                        document.getElementById("title").textContent = "í˜„ì¬ ì°¨ëŸ‰ ìƒíƒœ : ìš´í–‰ì¤‘ ğŸš—ğŸ’¨";
                    } else {
                        document.getElementById("title").textContent = "âŒ ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘ ë¶ˆê°€";
                    }
                })
                .catch(error => {
                    console.error('ì°¨ëŸ‰ ìš´í–‰ ì‹œì‘ ì‹¤íŒ¨:', error);
                    document.getElementById("title").textContent = "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ ë°œìƒ"
                });
    });

    document.getElementById("vehicle-off").addEventListener("click", function () {
        fetch('/api/v1/emulator/key-off', {
            method: 'POST',
            headers: {
                'Accept': 'application/json'
            }
        })
                .then(response => response.json())
                .then(data => {
                    console.log('ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ ìš”ì²­ ê²°ê³¼:', data);
                    if (data.isSuccess) {
                        document.getElementById("title").textContent = "í˜„ì¬ ì°¨ëŸ‰ ìƒíƒœ : ì •ì§€ ğŸš˜";
                    } else {
                        document.getElementById("title").textContent = "âŒ ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ ë¶ˆê°€";
                    }
                })
                .catch(error => {
                    console.error('ì°¨ëŸ‰ ìš´í–‰ ì¢…ë£Œ ì‹¤íŒ¨:', error);
                    document.getElementById("title").textContent = "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ ë°œìƒ"
                });
    });

</script>
</body>
</html>